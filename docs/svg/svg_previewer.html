<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>On-Chain Journal SVG Previewer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .ui-button.selected {
            border-color: #6366F1; /* indigo-500 */
            background-color: #4B5563; /* gray-600 */
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen">

    <div class="w-full max-w-6xl mx-auto p-4 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-100">On-Chain SVG Journal Previewer</h1>
            <p class="text-gray-400 mt-2">Modify the content and colors to see a live preview of your NFT.</p>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- Controls Column -->
            <div class="bg-gray-800 p-6 rounded-2xl shadow-lg">
                <h2 class="text-2xl font-semibold mb-6 border-b border-gray-700 pb-3">Customization</h2>
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Mood</label>
                        <div id="emoji-selector" class="flex flex-wrap gap-2">
                            <!-- Emoji buttons will be dynamically inserted here -->
                        </div>
                    </div>

                    <div>
                        <label for="text" class="block text-sm font-medium text-gray-300 mb-2">Journal Text</label>
                        <textarea id="text" rows="8" class="w-full bg-gray-700 border border-gray-600 text-white rounded-lg p-3 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">This is a much longer sample journal entry designed to test the full 400-character capacity of the text area. By filling this space, we can ensure that the line wrapping, font size, and overall layout remain balanced and readable. It's important to verify that the text doesn't overflow or get cut off. This provides a robust test case for the final design.</textarea>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Background Texture</label>
                        <div id="background-selector" class="flex flex-wrap gap-2">
                           <!-- Background buttons will be dynamically inserted here -->
                        </div>
                    </div>

                </div>
            </div>

            <!-- SVG Preview Column -->
            <div class="bg-gray-800 p-6 rounded-2xl shadow-lg flex flex-col items-center justify-center">
                 <h2 class="text-2xl font-semibold mb-6 text-center">Live Preview</h2>
                <div id="svg-preview" class="w-full h-full aspect-square flex items-center justify-center">
                    <!-- SVG will be injected here -->
                </div>
                <button id="export-svg-button" class="mt-6 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-lg transition">
                    Export SVG
                </button>
            </div>
        </div>
    </div>

    <script>
        const textInput = document.getElementById('text');
        const svgPreview = document.getElementById('svg-preview');
        const emojiSelector = document.getElementById('emoji-selector');
        const backgroundSelector = document.getElementById('background-selector');
        const exportButton = document.getElementById('export-svg-button');

        const backgrounds = {
            'Bob': {
                defs: `
                    <linearGradient gradientTransform="rotate(-202, 0.5, 0.5)" x1="50%" y1="0%" x2="50%" y2="100%" id="gggrain-gradient2-bob">
                        <stop stop-color="#ff9500" stop-opacity="1" offset="-0%"></stop>
                        <stop stop-color="rgba(255,255,255,0)" stop-opacity="0" offset="100%"></stop>
                    </linearGradient>
                    <linearGradient gradientTransform="rotate(202, 0.5, 0.5)" x1="50%" y1="0%" x2="50%" y2="100%" id="gggrain-gradient3-bob">
                        <stop stop-color="#f9f7f1ff" stop-opacity="1"></stop>
                        <stop stop-color="rgba(255,255,255,0)" stop-opacity="0" offset="40%"></stop>
                    </linearGradient>
                    <filter id="gggrain-filter-bob" x="-20%" y="-20%" width="140%" height="140%" filterUnits="objectBoundingBox" primitiveUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                        <feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="1" seed="2" stitchTiles="stitch" result="turbulence"></feTurbulence>
                        <feColorMatrix type="saturate" values="0" in="turbulence" result="colormatrix"></feColorMatrix>
                        <feComponentTransfer in="colormatrix" result="componentTransfer">
                            <feFuncR type="linear" slope="1.5"></feFuncR>
                            <feFuncG type="linear" slope="1.5"></feFuncG>
                            <feFuncB type="linear" slope="1.5"></feFuncB>
                        </feComponentTransfer>
                        <feColorMatrix in="componentTransfer" result="colormatrix2" type="matrix" values="1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 20 -12"></feColorMatrix>
                    </filter>
                `,
                content: `
                    <rect x="8" y="8" width="484" height="484" rx="15" ry="15" fill="#f25d00"></rect>
                    <rect x="8" y="8" width="484" height="484" rx="15" ry="15" fill="url(#gggrain-gradient3-bob)"></rect>
                    <rect x="8" y="8" width="484" height="484" rx="15" ry="15" fill="url(#gggrain-gradient2-bob)"></rect>
                    <rect x="8" y="8" width="484" height="484" rx="15" ry="15" fill="transparent" filter="url(#gggrain-filter-bob)" opacity="0.66" style="mix-blend-mode: soft-light"></rect>
                `
            },
            'Base': {
                defs: `
                    <linearGradient gradientTransform="rotate(-202, 0.5, 0.5)" x1="50%" y1="0%" x2="50%" y2="100%" id="gggrain-gradient2-base">
                        <stop stop-color="#3c8aff" stop-opacity="1" offset="-0%"></stop>
                        <stop stop-color="rgba(255,255,255,0)" stop-opacity="0" offset="100%"></stop>
                    </linearGradient>
                    <linearGradient gradientTransform="rotate(202, 0.5, 0.5)" x1="50%" y1="0%" x2="50%" y2="100%" id="gggrain-gradient3-base">
                        <stop stop-color="#f9f7f1ff" stop-opacity="1"></stop>
                        <stop stop-color="rgba(255,255,255,0)" stop-opacity="0" offset="40%"></stop>
                    </linearGradient>
                    <filter id="gggrain-filter-base" x="-20%" y="-20%" width="140%" height="140%" filterUnits="objectBoundingBox" primitiveUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                        <feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="1" seed="2" stitchTiles="stitch" result="turbulence"></feTurbulence>
                        <feColorMatrix type="saturate" values="0" in="turbulence" result="colormatrix"></feColorMatrix>
                        <feComponentTransfer in="colormatrix" result="componentTransfer">
                            <feFuncR type="linear" slope="1.5"></feFuncR>
                            <feFuncG type="linear" slope="1.5"></feFuncG>
                            <feFuncB type="linear" slope="1.5"></feFuncB>
                        </feComponentTransfer>
                        <feColorMatrix in="componentTransfer" result="colormatrix2" type="matrix" values="1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 20 -12"></feColorMatrix>
                    </filter>
                `,
                content: `
                    <rect x="8" y="8" width="484" height="484" rx="15" ry="15" fill="#0000ff"></rect>
                    <rect x="8" y="8" width="484" height="484" rx="15" ry="15" fill="url(#gggrain-gradient3-base)"></rect>
                    <rect x="8" y="8" width="484" height="484" rx="1is" ry="15" fill="url(#gggrain-gradient2-base)"></rect>
                    <rect x="8" y="8" width="484" height="484" rx="15" ry="15" fill="transparent" filter="url(#gggrain-filter-base)" opacity="0.66" style="mix-blend-mode: soft-light"></rect>
                `
            },
            'Vellum': {
                defs: `
                    <filter id="vellum-filter" x="-20%" y="-20%" width="140%" height="140%" filterUnits="objectBoundingBox" primitiveUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                        <feTurbulence type="fractalNoise" baseFrequency="0.05" numOctaves="4" seed="15" stitchTiles="stitch" result="noise" />
                        <feDiffuseLighting in="noise" lighting-color="#FFFAF0" surfaceScale="1.5" result="lit_noise">
                            <feDistantLight azimuth="235" elevation="60" />
                        </feDiffuseLighting>
                        <feBlend in="SourceGraphic" in2="lit_noise" mode="multiply" />
                    </filter>
                `,
                content: `
                    <rect x="8" y="8" width="484" height="484" rx="15" ry="15" fill="#f25d00" />
                    <rect x="8" y="8" width="484" height="484" rx="15" ry="15" fill="#ff9500" opacity="0.25" filter="url(#vellum-filter)" />
                `
            },
            'HyperLiquid': {
                defs: ``,
                content: `
                    <rect x="8" y="8" width="484" height="484" rx="15" ry="15" fill="#0F2925"></rect>
                `
            },
            'Classic': {
                defs: ``,
                content: `
                    <rect x="8" y="8" width="484" height="484" rx="15" ry="15" fill="#F9F7F1"></rect>
                `
            },
            'MegaETH': {
                defs: `
                    <linearGradient gradientTransform="rotate(-202, 0.5, 0.5)" x1="50%" y1="0%" x2="50%" y2="100%" id="gggrain-gradient2-megaeth">
                        <stop stop-color="#AAAAAA" stop-opacity="1" offset="-0%"></stop>
                        <stop stop-color="rgba(255,255,255,0)" stop-opacity="0" offset="100%"></stop>
                    </linearGradient>
                    <linearGradient gradientTransform="rotate(202, 0.5, 0.5)" x1="50%" y1="0%" x2="50%" y2="100%" id="gggrain-gradient3-megaeth">
                        <stop stop-color="#555555" stop-opacity="1"></stop>
                        <stop stop-color="rgba(255,255,255,0)" stop-opacity="0" offset="40%"></stop>
                    </linearGradient>
                    <filter id="gggrain-filter-megaeth" x="-20%" y="-20%" width="140%" height="140%" filterUnits="objectBoundingBox" primitiveUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                        <feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="1" seed="2" stitchTiles="stitch" result="turbulence"></feTurbulence>
                        <feColorMatrix type="saturate" values="0" in="turbulence" result="colormatrix"></feColorMatrix>
                        <feComponentTransfer in="colormatrix" result="componentTransfer">
                            <feFuncR type="linear" slope="1.5"></feFuncR>
                            <feFuncG type="linear" slope="1.5"></feFuncG>
                            <feFuncB type="linear" slope="1.5"></feFuncB>
                        </feComponentTransfer>
                        <feColorMatrix in="componentTransfer" result="colormatrix2" type="matrix" values="1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 20 -12"></feColorMatrix>
                    </filter>
                `,
                content: `
                    <rect x="8" y="8" width="484" height="484" rx="15" ry="15" fill="#111111"></rect>
                    <rect x="8" y="8" width="484" height="484" rx="15" ry="15" fill="url(#gggrain-gradient3-megaeth)"></rect>
                    <rect x="8" y="8" width="484" height="484" rx="15" ry="15" fill="url(#gggrain-gradient2-megaeth)"></rect>
                    <rect x="8" y="8" width="484" height="484" rx="15" ry="15" fill="transparent" filter="url(#gggrain-filter-megaeth)" opacity="0.66" style="mix-blend-mode: soft-light"></rect>
                `
            }
        };
        
        const emojis = ['üòÑ', 'üòç', 'ü§î', 'üò¢', 'üò†', 'üéâ', 'üöÄ', 'üí°', 'üôè', 'üî•'];
        let selectedMood = emojis[0];
        let selectedBackground = Object.keys(backgrounds)[0];

        function escapeString(str) {
            if (!str) return '';
            return str.replace(/&/g, '&amp;')
                      .replace(/</g, '&lt;')
                      .replace(/>/g, '&gt;')
                      .replace(/"/g, '&quot;')
                      .replace(/'/g, '&apos;');
        }
        
        function generateSVG(entry, backgroundDef, backgroundName) {
            const escapedText = escapeString(entry.text);
            const escapedMood = escapeString(entry.mood);
            const blockNumber = entry.blockNumber;
            const authorAddress = "0x1A2b...dE3F";
            const footerText = backgroundName.toUpperCase();

            // Define defaults
            let mainTextColor = 'white';
            let metaTextColor = 'white';
            let blockColor = 'white';
            let addressColor = 'white';
            let footerNameColor = 'white';
            let brandColor = 'white';
            let emojiColor = 'white';
            let mainTextShadow = '-1px -1px 1px rgba(0,0,0,0.4), 1px 1px 1px rgba(255,255,255,0.15)';
            let fontFamily = 'Arial, sans-serif'; // Default to sans-serif
            let logoColor = 'white';
            let logoOpacity = 0.3; // Default opacity

            // Theme-specific overrides
            if (backgroundName === 'HyperLiquid') {
                blockColor = '#8DFADF';
                addressColor = '#8DFADF';
                footerNameColor = '#8DFADF';
                brandColor = '#f9f7f1';
            } else if (backgroundName === 'Classic') {
                mainTextColor = '#2D2D2D';
                metaTextColor = '#5A5A5A';
                blockColor = '#8B7355';
                addressColor = '#8B7355';
                footerNameColor = '#8B7355';
                brandColor = '#8B7355';
                emojiColor = '#2D2D2D';
                mainTextShadow = '1px 1px 2px rgba(0,0,0,0.2), -1px -1px 2px rgba(255,255,255,0.9)';
                fontFamily = 'Georgia, serif'; // Override for Classic
                logoColor = '#5A5A5A'; // Dark logo for light bg
                logoOpacity = 0.5;
            } else if (backgroundName === 'MegaETH') {
                logoColor = '#AAAAAA'; // Use light grey from theme
                logoOpacity = 0.25; // Make it very discreet
            }


            return `
                <svg width="100%" height="100%" viewBox="0 0 500 500" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <style>
                            @keyframes typewriter {
                                0% { width: 0; }
                                50% { width: 80px; }
                                80% { width: 80px; }
                                100% { width: 0; }
                            }
                            #block-clip-rect {
                                animation: typewriter 4s steps(8) infinite;
                            }
                        </style>
                        <filter id="drop-shadow" x="-20%" y="-20%" width="140%" height="140%">
                            <feDropShadow dx="4" dy="4" stdDeviation="5" flood-color="#000" flood-opacity="0.4" />
                        </filter>
                        ${backgroundDef.defs}
                        <clipPath id="card-clip">
                            <rect x="8" y="8" width="484" height="484" rx="15" ry="15" />
                        </clipPath>
                        <clipPath id="block-clip">
                            <rect id="block-clip-rect" x="35" y="50" height="20" width="80" />
                        </clipPath>
                    </defs>
                    
                    <rect x="8" y="8" width="484" height="484" rx="15" ry="15" fill="transparent" filter="url(#drop-shadow)" />

                    <g clip-path="url(#card-clip)">
                        ${backgroundDef.content}
                    
                        <g>
                            <!-- Rabbit Logo -->
                            <!-- Centered at (250, 450) with scale(0.04) -> size ~41px. Translate to (250-20.5, 450-20.5) -->
                            <g transform="translate(230, 430) scale(0.04)" fill="${logoColor}" fill-opacity="${logoOpacity}">
                                <path d="M639,774.99 C627.33,774.96 616.17,774.9 605,774.91 C600.32,774.91 596.33,773.81 593.02,770.04 C576.52,751.25 561.06,731.61 545.23,712.27 C543.31,709.93 544.02,707.7 544.58,705.23 C548.44,688.06 547.84,671.28 540.65,654.9 C529.75,630.08 504.9,613.52 479.32,614.33 C472.27,614.56 465.35,616.33 462.05,619.01 C468.77,619.95 475.26,620.27 481.44,621.82 C508.99,628.7 528.45,644.56 534.55,673.27 C539.08,694.63 532.17,713.37 518.11,729.58 C515.35,732.78 511.8,735.29 508.62,738.12 C508.93,738.7 509.25,739.28 509.57,739.86 C515.33,739.86 521.09,739.7 526.85,739.89 C546.51,740.54 560.9,750.76 567.37,768.49 C567.94,770.06 568.6,771.6 568.33,773.48 C566.55,775.31 564.11,774.88 561.86,774.88 C524.7,774.92 487.55,774.99 450.39,774.86 C435.65,774.81 421.14,773.65 408.13,765.37 C393.26,755.92 383.55,742.48 377.81,726.21 C364.45,688.3 369.75,652.02 388.93,617.47 C406.95,585 434.41,562.19 466.08,543.9 C476.92,537.63 488.3,532.51 499.83,527.68 C501.19,527.12 502.51,526.24 504.78,526.89 C507.25,535.28 510.88,543.56 516.08,551.17 C532.2,574.7 555.01,586.75 582.69,590.76 C590.15,591.84 597.64,592.12 605.12,591.65 C609.55,591.37 611.01,593.18 611.23,597.31 C612.52,621.37 608.48,644.38 595.14,664.66 C589.85,672.7 589.48,680.1 591.59,688.52 C595.69,704.95 601.95,720.48 610.48,735.13 C612.66,738.87 615.51,740.36 619.69,740.77 C636.46,742.41 649.44,753.4 654.52,769.52 C655.85,773.72 654.48,775.05 650.49,774.98 C646.83,774.91 643.16,774.98 639,774.99 z"/>
                                <path d="M613.98,452.87 C630,460.05 642.09,471.18 651.48,485.42 C659.84,498.12 667.15,511.35 672.61,525.58 C674.19,529.71 674.1,533.52 672.57,537.67 C665.42,556.98 653.33,570.6 632.49,575.87 C604.18,583.03 576.66,583.04 550.6,568.43 C528.42,556 515.37,537.1 514.22,511.31 C513.63,498.29 516.36,485.44 520.62,473.11 C522.25,468.38 521.33,465.47 517.69,462.27 C500.63,447.29 484.95,430.97 471.19,412.84 C453.57,389.65 443.33,363.48 438.61,334.86 C435.14,313.81 434.94,292.8 437.67,271.7 C437.97,269.41 438.2,267.11 439.79,265 C443.77,265.59 446.67,268.23 449.8,270.3 C478.47,289.22 503.21,312.16 522.29,340.99 C536.68,362.72 544.64,387.01 551.17,411.89 C553.66,421.36 555.81,430.95 557.66,440.57 C558.45,444.72 559.99,446.14 564.27,445.61 C581.33,443.49 597.8,446.04 613.98,452.87 M604.04,514.76 C605.46,513.93 607,513.24 608.3,512.23 C613.93,507.88 615.72,499.49 612.53,492.87 C609.61,486.81 602.4,483.35 595.91,484.9 C586.51,487.13 581.49,494.8 583.49,503.84 C585.28,511.92 594.11,516.92 604.04,514.76 z"/>
                                <path d="M595.27,353.91 C600.74,380.11 601.44,406.13 599.15,432.29 C598.82,436.1 597.45,438.16 593.03,436.74 C586.3,434.56 579.18,435 572.24,434.61 C568,434.37 566.55,432.68 565.72,428.9 C561.98,411.66 557.51,394.59 551.75,377.93 C546.41,362.47 539.31,347.75 530.36,334.06 C527.11,329.1 525.41,324.22 525.41,318.31 C525.44,299.32 525.89,280.41 530.76,261.89 C531.22,260.16 531.8,258.45 532.31,256.77 C549.88,259.86 586.61,316.58 595.27,353.91 z"/>
                                <path d="M366.5,727.58 C371.27,741.06 378.34,752.81 387.66,764.08 C379.45,767.88 371.48,769.32 363.44,768.71 C333.49,766.41 314.11,740.2 324.82,707.36 C325.81,704.33 327.62,702.26 330.71,701.11 C339.12,698 347.56,697.77 356.16,700.13 C359.23,700.97 360.98,702.6 361.27,705.97 C361.9,713.29 364.1,720.27 366.5,727.58 z"/>
                            </g>
                            
                            <text x="450" y="90" font-family="sans-serif" font-size="70" text-anchor="end" fill="${emojiColor}">${escapedMood}</text>
                            <text x="35" y="45" font-family="monospace" font-size="14" fill="${metaTextColor}" fill-opacity="0.7">minted on block</text>
                            <g clip-path="url(#block-clip)">
                                <text x="35" y="65" font-family="monospace" font-size="16" fill="${blockColor}" fill-opacity="0.8">#${blockNumber}</text>
                            </g>
                            <foreignObject x="50" y="100" width="400" height="334">
                                <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%;">
                                    <div style="color: ${mainTextColor}; font-family: ${fontFamily}, serif; font-size: 18px; word-wrap: break-word; line-height: 1.5; text-shadow: ${mainTextShadow}; text-align: left; max-width: 100%;">
                                        ${escapedText}
                                    </div>
                                    <div style="margin-top: 20px; color: ${addressColor}; font-family: monospace; font-size: 14px; opacity: 0.8;">
                                        ${authorAddress}
                                    </div>
                                </div>
                            </foreignObject>
                             <text x="35" y="475" font-family="monospace" font-size="16" fill="${footerNameColor}" fill-opacity="0.7" text-anchor="start">${footerText}</text>
                             <text x="465" y="475" font-family="monospace" font-size="16" fill="${brandColor}" fill-opacity="0.7" text-anchor="end">MintMyMood</text>
                        </g>
                    </g>
                </svg>
            `;
        }


        function updatePreview() {
            const entry = {
                mood: selectedMood,
                text: textInput.value,
                blockNumber: Math.floor(100000 + Math.random() * 900000)
            };
            const backgroundDef = backgrounds[selectedBackground];
            svgPreview.innerHTML = generateSVG(entry, backgroundDef, selectedBackground);
        }

        function setupControls() {
            // Emoji buttons
            emojis.forEach(emoji => {
                const button = document.createElement('button');
                button.textContent = emoji;
                button.classList.add('ui-button', 'p-2', 'rounded-lg', 'text-2xl', 'transition', 'border-2', 'bg-gray-700', 'border-transparent', 'hover:bg-gray-600');
                if (emoji === selectedMood) button.classList.add('selected');
                button.addEventListener('click', () => {
                    selectedMood = emoji;
                    document.querySelectorAll('#emoji-selector .ui-button').forEach(btn => btn.classList.remove('selected'));
                    button.classList.add('selected');
                    updatePreview();
                });
                emojiSelector.appendChild(button);
            });

            // Background buttons
            Object.keys(backgrounds).forEach(name => {
                const button = document.createElement('button');
                button.textContent = name;
                button.classList.add('ui-button', 'px-4', 'py-2', 'rounded-lg', 'text-md', 'transition', 'border-2', 'bg-gray-700', 'border-transparent', 'hover:bg-gray-600');
                if (name === selectedBackground) button.classList.add('selected');
                button.addEventListener('click', () => {
                    selectedBackground = name;
                    document.querySelectorAll('#background-selector .ui-button').forEach(btn => btn.classList.remove('selected'));
                    button.classList.add('selected');
                    updatePreview();
                });
                backgroundSelector.appendChild(button);
            });
        }

        function handleExport() {
            const svgData = svgPreview.innerHTML;
            const blob = new Blob([svgData], { type: 'image/svg+xml;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'mint-my-mood.svg';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        textInput.addEventListener('input', updatePreview);
        exportButton.addEventListener('click', handleExport);
        document.addEventListener('DOMContentLoaded', () => {
            setupControls();
            updatePreview();
        });
    </script>

</body>
</html>